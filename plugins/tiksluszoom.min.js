(function(a){var b=function(f,j){var f=a(f),u=this,C=false,E=false,k=0,A=0,B=new Object(),z=a(z),v=0,s=a("body");var q={delay:18,lensWidth:100,lensHeight:100,lensBackgroundColor:"#fff",lensOpacity:0.5,previewWidth:200,previewHeight:200,lensBorder:1,lensBorderColor:"#000",showLens:true,loaderImage:"loader.gif",zoomAnimation:false,zoomAnimationInterval:80,annotationsBorderColor:"#000",annotationBackgroundColor:"#fff",zoomPreviewWindowEffect:"default",annotationOpacity:0.3,annotations:new Array()};var t=f.find("img.tiksluszoom"),m=f.find("img.tiksluszoom").attr("data-big-image"),K;j=a.extend(q,j);var I=function(){f.append("<div class='zoom-preview-wrapper'><div class='zoom-preview'></div><div class='annotation'></div></div>");};this.getCoord=function(){B.left=t.position().left;B.top=t.position().top;B.right=t.width();B.bottom=t.height();return B;};var n=function(){f.append("<div class='lens'></div>");K=f.find(".lens");if(j.showLens==true){K.css({width:j.lensWidth,height:j.lensHeight,opacity:j.lensOpacity,backgroundColor:j.lensBackgroundColor,border:j.lensBorder,borderTopStyle:"solid",borderLeftStyle:"solid",borderRightStyle:"solid",borderBottomStyle:"solid",borderTopColor:j.lensBordercolor,borderLeftColor:j.lensBordercolor,borderBottomColor:j.lensBordercolor});}else{K.find(".lens").css({width:j.lensWidth,height:j.lensHeight,cursor:"crosshair"});}return K;};var H=function(){K.css({visibility:"hidden"});};var r=function(){K.css({visibility:"visible"});};var h=function(){var O=u.getCoord();for(var N=0;N<j.annotations.length;N++){var M=0,L=0;M=O.left+j.annotations[N].x;L=O.top+j.annotations[N].y;f.append("<div  style='border:1px solid ;border-color:"+j.annotationsBorderColor+";background-color:"+j.annotationBackgroundColor+";position:absolute;left:"+M+"px;top:"+L+"px;width:"+j.lensWidth+"px;height:"+j.lensHeight+"px;border:1px solid #eee;z-index:0;opacity:"+j.annotationOpacity+"'></div>");}};var y=function(M,Q){if(j.annotations.length>0){for(var O=0;O<j.annotations.length;O++){var N=0,L=0;var P=u.getCoord();N=P.left+j.annotations[O].x;L=P.top+j.annotations[O].y;if(M>=N&&M<=N+j.lensWidth&&Q>=L&&Q<=L+j.lensHeight){f.find(".zoom-preview-wrapper .annotation").show().html(j.annotations[O].annotation);}}}};var g=function(){if(v==0){return true;}else{return false;}};var l=function(){f.find(".zoom-preview-wrapper").hide();v=0;};var G=function(){var N=t.position().left+t.width()+20;var M=t.position().top;var L=t.height()+M;if(L>a(window).height()+a(window).scrollTop()||N>a(window).width()+a(window).scrollLeft()){M=M-t.height();N=t.position().left;}f.find(".zoom-preview-wrapper").css({left:N+"px",top:M+"px"});switch(j.zoomPreviewWindowEffect){case"fade":f.find(".zoom-preview-wrapper").fadeIn("slow");break;case"default":f.find(".zoom-preview-wrapper").show();break;default:f.find(".zoom-preview-wrapper").show();}v=1;};var i=function(){f.find(".zoom-preview-wrapper .annotation").html("").hide();};h();I();n();var D=function(){var M=new Image();var O=u.getCoord();M.src=m;var Q=f.find(".zoom-preview").width()/2;var P=f.find(".zoom-preview").height()/2;var N=O.left+O.right/2;var L=O.top+O.bottom/2;if(f.find(".zoom-loading").length<=0){f.append("<div class='zoom-loading'></div>");f.find(".zoom-loading").append("<img src='"+j.loaderImage+"' border='0'>");}t.addClass("fade");f.find(".zoom-loading").css({position:"absolute",left:N+"px",top:L+"px",zIndex:1000});a("body").css("cursor","none");H();t.css({opacity:0.3});M.onload=function(){k=M.width;A=M.height;f.find(".zoom-preview").css({"background-image":"url('"+M.src+"')",visibility:"visible"});f.find(".zoom-loading").remove();G();t.removeClass("fade");a("body").css("cursor","haircross");C=true;r();t.css({opacity:1});};};var x=function(N,M){var L=u.getCoord();ctop=M-j.lensHeight/2-L.top;cleft=N-j.lensWidth/2-L.left;K.css({top:M-j.lensHeight/2+"px",left:N-j.lensWidth/2+"px",visibility:"visible",width:j.lensWidth+"px",height:j.lensHeight+"px"});E=true;};var F=function(M,L){ctop=L-j.lensHeight/2;cleft=M-j.lensWidth/2;K.css({top:L-j.lensHeight/2+"px",left:M-j.lensWidth/2+"px",width:j.lensWidth+"px",height:j.lensHeight+"px"});};var e=function(){K.css({top:0,left:0,widht:0,height:0,visibility:"hidden"});s.css({cursor:"default"});};var w=function(){if(K.is(":visible")){return false;}else{return true;}};var d=function(N,L){var M=u.getCoord();if(C==true&&E==true){var O=0;var Q=0;Q=parseFloat(k/t.width()).toFixed(1);O=parseFloat(A/t.height()).toFixed(1);Q=parseFloat(k/t.width()).toFixed(1);O=parseFloat(A/t.height()).toFixed(1);var S=L-j.lensHeight/2-M.top;var P=N-j.lensWidth/2-M.left;if(j.zoomAnimation==true){var T=-(P*Q);var R=-(S*O);f.find(".zoom-preview").animate({"background-position-x":T+"px","background-position-y":R+"px"},j.zoomAnimationInterval);}else{f.find(".zoom-preview").css({backgroundPosition:-(P*Q)+"px "+(-(S*O)+"px")});}f.find(".zoom-preview").css("width",j.lensWidth*Q+"px");f.find(".zoom-preview").css("height",j.lensHeight*O+"px");f.find(".zoom-preview-wrapper").css("width",j.lensWidth*Q+"px");f.find(".zoom-preview-wrapper").css("height",j.lensHeight*O+"px");}};var o=function(){var M;var N;M=screen.width;N=a(z).height();var L="<div id='tiksluszoom_overlay'></div>";if(a("#tiksluszoom_overlay").length==0){s.append(L);}a("#tiksluszoom_overlay").css({left:0,top:0,width:M+"px",height:N+"px",position:"absolute"}).fadeIn("fast");};var c=function(M,L){var P=(a(window).width()-M)/2+a(window).scrollLeft();var O=(a(window).height()-L)/2+a(window).scrollTop();a("#tiksluszoom_lightbox").remove();var N="<div id='tiksluszoom_lightbox' style='width:"+M+"px;left:"+P+"px;top:"+O+"px;height:"+L+"px;position:absolute'><div class='tiksluszoom_lightbox_inner'><ul class='operations'><li><a href='#' class='tiksluszoom_lightbox_close'>X</a></li></ul></div></div>";s.append(N);a("#tiksluszoom_lightbox").fadeIn("slow");};this.destroyLightbox=function(){a("#tiksluszoom_lightbox").fadeOut("slow").find("img").remove();};this.destroyOverlay=function(){a("#tiksluszoom_overlay").fadeOut("fast").css({width:0,height:0});};var p=function(){var L=a(window).width();var O=a(window).height();var M=0;var N=0;M=k;N=A;if(k>=L){M=L*90/100;}if(A>=O){N=O*90/100;}f.find("div").hide();c(M,N);a(".tiksluszoom_lightbox_inner").find(".preview").remove();a(".tiksluszoom_lightbox_inner").prepend("<img  class='preview' src='"+m+"' style='max-width:100%;max-height:100%;'/>").fadeIn("slow");s.css({cursor:"default"});a("a.tiksluszoom_lightbox_close").click(function(P){P.preventDefault();u.destroyLightbox();u.destroyOverlay();});a("#tiksluszoom_overlay").click(function(P){P.preventDefault();u.destroyLightbox();u.destroyOverlay();});a(".preview").click(function(P){u.destroyLightbox();u.destroyOverlay();});};var J=function(){if(a("#tiksluszoom_lightbox").is(":visible")){var M=a("#tiksluszoom_lightbox").height();var L=a("#tiksluszoom_lightbox").width();a("#tiksluszoom_lightbox").animate({top:(a(window).height()-M)/2+a(window).scrollTop(),left:(a(window).width()-L)/2+a(window).scrollLeft()},5);}};t.mouseenter(function(L){if(E==false){x(L.pageX,L.pageY);}if(C==false){D();}if(!g()){G();}if(w()==true){f.find("div").show();}});t.mousemove(function(L){if(E){d(L.pageX,L.pageY);F(L.pageX,L.pageY);}});K.mousemove(function(L){if(L.pageX>=t.position().left&&L.pageX<=(t.width()+t.position().left)&&L.pageY>=t.position().top&&(L.pageY<=t.height()+t.position().top)&&E==true){i();if(w()==true){x();r();}if(g()){G();}F(L.pageX,L.pageY);d(L.pageX,L.pageY);y(L.pageX,L.pageY);}else{e();s.css({cursor:"default"});E=false;l();}});K.click(function(L){o();p();L.preventDefault();});z.scroll(function(){if(a("#tiksluszoom_lightbox").is(":visible")){J();}});};a.fn.tiksluszoom=function(c){return this.each(function(){var d=a(this);if(d.data("tiksluszoom")){return;}var e=new b(this,c);d.data("tiksluszoom",e);});};})(jQuery);